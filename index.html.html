<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faith Connect - Church Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs v9 (modular) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, RecaptchaVerifier, signInWithPhoneNumber, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        
        // ==================== FIREBASE CONFIGURATION ====================
        // REPLACE WITH YOUR FIREBASE CONFIG FROM FIREBASE CONSOLE
        const firebaseConfig = {
  apiKey: "AIzaSyA2GUik7GiJsUpnoivHuWejFeP_gT4fnPA",
  authDomain: "church-connect-a5c75.firebaseapp.com",
  projectId: "church-connect-a5c75",
  storageBucket: "church-connect-a5c75.firebasestorage.app",
  messagingSenderId: "588294575887",
  appId: "1:588294575887:web:3849a9f413c61e65bad07a",
  measurementId: "G-4G0136HNK2"
};
    // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        auth.languageCode = 'en';

        // Make auth available globally
        window.firebaseAuth = auth;
        window.RecaptchaVerifier = RecaptchaVerifier;
        window.signInWithPhoneNumber = signInWithPhoneNumber;
        window.signOut = signOut;
        
        console.log('Firebase initialized successfully');
    </script>
    
    <style>
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>
    <div id="recaptcha-container"></div>

    <script>
        // ==================== STATE MANAGEMENT ====================
        const state = {
            currentUser: null,
            currentPage: 'login',
            mobileMenuOpen: false,
            readings: [],
            announcements: [],
            bookings: [],
            prayers: [],
            events: [],
            searchTerm: '',
            otpSent: false,
            isNewUser: false,
            phoneNumber: '',
            confirmationResult: null,
            recaptchaVerifier: null,
            showForms: {
                reading: false,
                announcement: false,
                booking: false,
                prayer: false,
                event: false
            }
        };

        // Storage utilities
        const storage = {
            get: (key) => {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            },
            set: (key, value) => {
                localStorage.setItem(key, JSON.stringify(value));
            },
            remove: (key) => {
                localStorage.removeItem(key);
            }
        };

        // Load data on startup
        function loadData() {
            state.currentUser = storage.get('current_user');
            state.readings = storage.get('readings') || [];
            state.announcements = storage.get('announcements') || [];
            state.bookings = storage.get('bookings') || [];
            state.prayers = storage.get('prayers') || [];
            state.events = storage.get('events') || [];
            
            if (state.currentUser) {
                state.currentPage = 'dashboard';
            }
        }

        // Initialize reCAPTCHA
        function initRecaptcha() {
            if (!state.recaptchaVerifier && window.RecaptchaVerifier) {
                try {
                    state.recaptchaVerifier = new window.RecaptchaVerifier(window.firebaseAuth, 'recaptcha-container', {
                        'size': 'invisible',
                        'callback': (response) => {
                            console.log('reCAPTCHA solved');
                        },
                        'expired-callback': () => {
                            console.log('reCAPTCHA expired');
                        }
                    });
                    console.log('reCAPTCHA initialized');
                } catch (error) {
                    console.error('Error initializing reCAPTCHA:', error);
                }
            }
        }

        // ==================== FIREBASE AUTHENTICATION FUNCTIONS ====================
        
        // Send OTP to phone number
        async function handleSendOTP() {
            const phoneInput = document.getElementById('phoneNumber');
            if (!phoneInput || phoneInput.value.length < 9) {
                alert('Please enter a valid phone number (at least 9 digits)');
                return;
            }

            let phoneNumber = phoneInput.value.trim();
            
            // Format phone number with country code if not already present
            if (!phoneNumber.startsWith('+')) {
                // Default to Kenya (+254), CHANGE THIS TO YOUR COUNTRY CODE
                // Remove leading zero if present
                phoneNumber = phoneNumber.replace(/^0+/, '');
                phoneNumber = '+254' + phoneNumber; // Change +254 to your country code
            }

            state.phoneNumber = phoneNumber;

            // Show loading
            const button = document.querySelector('#sendOtpBtn');
            if (button) {
                button.disabled = true;
                button.innerHTML = '<span class="spinner"></span>Sending OTP...';
            }

            try {
                // Initialize reCAPTCHA if not already done
                if (!state.recaptchaVerifier) {
                    initRecaptcha();
                }

                console.log('Sending OTP to:', phoneNumber);

                // Send OTP via Firebase
                const confirmationResult = await window.signInWithPhoneNumber(
                    window.firebaseAuth,
                    phoneNumber,
                    state.recaptchaVerifier
                );
                
                state.confirmationResult = confirmationResult;
                state.otpSent = true;
                
                // Check if user exists in localStorage
                const existingUsers = storage.get('all_users') || {};
                state.isNewUser = !existingUsers[phoneNumber];

                alert('OTP sent successfully to ' + phoneNumber + '. Please check your phone.');
                render();

            } catch (error) {
                console.error('Error sending OTP:', error);
                let errorMessage = 'Failed to send OTP. ';
                
                if (error.code === 'auth/invalid-phone-number') {
                    errorMessage += 'Invalid phone number format. Please include country code (e.g., +254712345678).';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage += 'Too many attempts. Please try again later.';
                } else if (error.code === 'auth/quota-exceeded') {
                    errorMessage += 'SMS quota exceeded. Please try again tomorrow.';
                } else {
                    errorMessage += error.message;
                }
                
                alert(errorMessage);
                
                // Reset the button
                if (button) {
                    button.disabled = false;
                    button.innerHTML = 'Send OTP';
                }

                // Reset reCAPTCHA for retry
                state.recaptchaVerifier = null;
                initRecaptcha();
            }
        }

        // Verify OTP and login
        async function handleLogin() {
            const otpInput = document.getElementById('otp');
            const userNameInput = document.getElementById('userName');
            
            if (!otpInput || !otpInput.value) {
                alert('Please enter the OTP code');
                return;
            }

            const otp = otpInput.value.trim();

            if (otp.length !== 6) {
                alert('OTP must be 6 digits');
                return;
            }

            // Show loading
            const button = document.querySelector('#verifyOtpBtn');
            if (button) {
                button.disabled = true;
                button.innerHTML = '<span class="spinner"></span>Verifying...';
            }

            try {
                console.log('Verifying OTP...');

                // Verify OTP with Firebase
                const result = await state.confirmationResult.confirm(otp);
                const firebaseUser = result.user;

                console.log('User signed in successfully:', firebaseUser.uid);

                // Get or create user data
                const allUsers = storage.get('all_users') || {};
                let userData = allUsers[state.phoneNumber];

                if (!userData || state.isNewUser) {
                    // New user - require name
                    if (!userNameInput || !userNameInput.value.trim()) {
                        alert('Please enter your name');
                        if (button) {
                            button.disabled = false;
                            button.innerHTML = 'Verify & Login';
                        }
                        return;
                    }
                    
                    const userName = userNameInput.value.trim();
                    userData = {
                        phone: state.phoneNumber,
                        firebaseUid: firebaseUser.uid,
                        name: userName,
                        // CHANGE THIS NUMBER TO YOUR ADMIN PHONE (with country code)
                        role: state.phoneNumber === '+254712345678' ? 'admin' : 'member',
                        joinedDate: new Date().toISOString()
                    };
                    allUsers[state.phoneNumber] = userData;
                    storage.set('all_users', allUsers);
                }

                state.currentUser = userData;
                storage.set('current_user', userData);
                state.currentPage = 'dashboard';
                
                alert('Login successful! Welcome ' + userData.name);
                render();

            } catch (error) {
                console.error('Error verifying OTP:', error);
                let errorMessage = 'Invalid OTP. ';
                
                if (error.code === 'auth/invalid-verification-code') {
                    errorMessage += 'The code you entered is incorrect. Please try again.';
                } else if (error.code === 'auth/code-expired') {
                    errorMessage += 'OTP has expired. Please request a new code.';
                } else {
                    errorMessage += error.message;
                }
                
                alert(errorMessage);
                
                // Re-enable button
                if (button) {
                    button.disabled = false;
                    button.innerHTML = 'Verify & Login';
                }
            }
        }

        function handleChangeNumber() {
            state.otpSent = false;
            state.isNewUser = false;
            state.confirmationResult = null;
            render();
        }

        async function handleLogout() {
            try {
                await window.signOut(window.firebaseAuth);
                state.currentUser = null;
                storage.remove('current_user');
                state.currentPage = 'login';
                render();
            } catch (error) {
                console.error('Error signing out:', error);
                alert('Error logging out: ' + error.message);
            }
        }

        // ==================== UI FUNCTIONS ====================

        function changePage(page) {
            state.currentPage = page;
            state.mobileMenuOpen = false;
            render();
        }

        function toggleMobileMenu() {
            state.mobileMenuOpen = !state.mobileMenuOpen;
            render();
        }

        function toggleForm(formType) {
            state.showForms[formType] = !state.showForms[formType];
            render();
        }

        function handleSearch(value) {
            state.searchTerm = value;
            render();
        }

        // ==================== DATA FUNCTIONS ====================

        function addReading() {
            const title = document.getElementById('readingTitle').value;
            const date = document.getElementById('readingDate').value;
            const scripture = document.getElementById('readingScripture').value;
            const content = document.getElementById('readingContent').value;
            const audioUrl = document.getElementById('readingAudio').value;

            if (title && content) {
                const reading = {
                    id: Date.now(),
                    title,
                    date,
                    scripture,
                    content,
                    audioUrl,
                    addedBy: state.currentUser.name
                };
                state.readings.unshift(reading);
                storage.set('readings', state.readings);
                state.showForms.reading = false;
                render();
            } else {
                alert('Please fill in title and content');
            }
        }

        function addAnnouncement() {
            const title = document.getElementById('announcementTitle').value;
            const priority = document.getElementById('announcementPriority').value;
            const content = document.getElementById('announcementContent').value;

            if (title && content) {
                const announcement = {
                    id: Date.now(),
                    title,
                    priority,
                    content,
                    date: new Date().toLocaleDateString(),
                    addedBy: state.currentUser.name
                };
                state.announcements.unshift(announcement);
                storage.set('announcements', state.announcements);
                state.showForms.announcement = false;
                render();
            } else {
                alert('Please fill in all fields');
            }
        }

        function addBooking() {
            const pastor = document.getElementById('bookingPastor').value;
            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('bookingTime').value;
            const reason = document.getElementById('bookingReason').value;

            if (date && time && reason) {
                const booking = {
                    id: Date.now(),
                    pastor,
                    date,
                    time,
                    reason,
                    memberName: state.currentUser.name,
                    memberPhone: state.currentUser.phone,
                    status: 'pending'
                };
                state.bookings.push(booking);
                storage.set('bookings', state.bookings);
                state.showForms.booking = false;
                render();
            } else {
                alert('Please fill in all required fields');
            }
        }

        function selectTimeSlot(time) {
            document.getElementById('bookingTime').value = time;
            // Highlight selected slot
            const slots = document.querySelectorAll('.time-slot');
            slots.forEach(slot => {
                if (slot.textContent.trim() === time) {
                    slot.classList.add('border-purple-600', 'bg-purple-50', 'text-purple-700', 'font-semibold');
                    slot.classList.remove('border-gray-300');
                } else {
                    slot.classList.remove('border-purple-600', 'bg-purple-50', 'text-purple-700', 'font-semibold');
                    slot.classList.add('border-gray-300');
                }
            });
        }

        function addPrayer() {
            const title = document.getElementById('prayerTitle').value;
            const content = document.getElementById('prayerContent').value;

            if (title && content) {
                const prayer = {
                    id: Date.now(),
                    title,
                    content,
                    author: state.currentUser.name,
                    date: new Date().toLocaleDateString(),
                    prayerCount: 0
                };
                state.prayers.unshift(prayer);
                storage.set('prayers', state.prayers);
                state.showForms.prayer = false;
                render();
            } else {
                alert('Please fill in all fields');
            }
        }

        function addPrayerSupport(prayerId) {
            const prayer = state.prayers.find(p => p.id === prayerId);
            if (prayer) {
                prayer.prayerCount++;
                storage.set('prayers', state.prayers);
                render();
            }
        }

        function addEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const location = document.getElementById('eventLocation').value;
            const description = document.getElementById('eventDescription').value;

            if (title && date && time) {
                const event = {
                    id: Date.now(),
                    title,
                    date,
                    time,
                    location,
                    description,
                    organizer: state.currentUser.name
                };
                state.events.push(event);
                state.events.sort((a, b) => new Date(a.date) - new Date(b.date));
                storage.set('events', state.events);
                state.showForms.event = false;
                render();
            } else {
                alert('Please fill in required fields (title, date, time)');
            }
        }

        // ==================== RENDER FUNCTIONS ====================

        function renderLoginPage() {
            setTimeout(() => {
                initRecaptcha();
            }, 100);

            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
                        <div class="text-center mb-8">
                            <div class="bg-gradient-to-r from-blue-600 to-purple-600 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                            </div>
                            <h1 class="text-3xl font-bold text-gray-800 mb-2">Faith Connect</h1>
                            <p class="text-gray-600">Your Church Community Platform</p>
                        </div>

                        ${!state.otpSent ? `
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Mobile Number
                                    </label>
                                    <input 
                                        type="tel" 
                                        id="phoneNumber" 
                                        placeholder="e.g., 0712345678 or +254712345678"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <p class="text-xs text-gray-500 mt-2">Enter with or without country code</p>
                                </div>
                                <button 
                                    id="sendOtpBtn"
                                    onclick="handleSendOTP()"
                                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all">
                                    Send OTP
                                </button>
                                <p class="text-xs text-center text-gray-500 mt-4">
                                    You will receive a 6-digit verification code via SMS
                                </p>
                            </div>
                        ` : `
                            <div class="space-y-4">
                                ${state.isNewUser ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            Your Name *
                                        </label>
                                        <input 
                                            type="text" 
                                            id="userName" 
                                            placeholder="Enter your full name"
                                            required
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    </div>
                                ` : ''}
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Enter OTP Code
                                    </label>
                                    <input 
                                        type="text" 
                                        id="otp" 
                                        placeholder="Enter 6-digit code"
                                        maxlength="6"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-center text-2xl tracking-widest">
                                    <p class="text-xs text-gray-500 mt-2">
                                        Code sent to ${state.phoneNumber}
                                    </p>
                                </div>
                                <button 
                                    id="verifyOtpBtn"
                                    onclick="handleLogin()"
                                    class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all">
                                    Verify & Login
                                </button>
                                <button 
                                    onclick="handleChangeNumber()"
                                    class="w-full text-gray-600 py-2 text-sm hover:text-gray-800">
                                    Change Number
                                </button>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderNavigation() {
            const navItems = [
                { id: 'dashboard', label: 'Dashboard' },
                { id: 'readings', label: 'Readings' },
                { id: 'announcements', label: 'Announcements' },
                { id: 'bookings', label: 'Bookings' },
                { id: 'prayers', label: 'Prayer Wall' },
                { id: 'events', label: 'Events' }
            ];

            return `
                <nav class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
                    <div class="max-w-7xl mx-auto px-4">
                        <div class="flex justify-between items-center h-16">
                            <div class="flex items-center space-x-3">
                                <span class="text-xl font-bold">⛪ Faith Connect</span>
                            </div>
                            
                            <div class="hidden md:flex space-x-1">
                                ${navItems.map(item => `
                                    <button onclick="changePage('${item.id}')"
                                        class="px-4 py-2 rounded-lg transition-all ${state.currentPage === item.id ? 'bg-white bg-opacity-20' : 'hover:bg-white hover:bg-opacity-10'}">
                                        ${item.label}
                                    </button>
                                `).join('')}
                            </div>

                            <div class="flex items-center space-x-4">
                                <span class="hidden md:inline text-sm">👤 ${state.currentUser.name}</span>
                                <button onclick="handleLogout()" class="hover:bg-white hover:bg-opacity-10 px-3 py-2 rounded-lg transition-all text-sm">
                                    Logout
                                </button>
                                <button onclick="toggleMobileMenu()" class="md:hidden p-2">
                                    ${state.mobileMenuOpen ? '✕' : '☰'}
                                </button>
                            </div>
                        </div>
                    </div>

                    ${state.mobileMenuOpen ? `
                        <div class="md:hidden bg-white bg-opacity-10">
                            ${navItems.map(item => `
                                <button onclick="changePage('${item.id}')"
                                    class="w-full text-left px-6 py-3 hover:bg-white hover:bg-opacity-10 ${state.currentPage === item.id ? 'bg-white bg-opacity-20' : ''}">
                                    ${item.label}
                                </button>
                            `).join('')}
                        </div>
                    ` : ''}
                </nav>
            `;
        }

        function renderDashboard() {
            return `
                <div class="max-w-7xl mx-auto px-4 py-8 fade-in">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome, ${state.currentUser.name}!</h2>
                    <p class="text-gray-600 mb-8">
                        ${state.currentUser.role === 'admin' ? '👑 Administrator Access' : '📱 ' + state.currentUser.phone}
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                            <div class="text-4xl mb-2">📖</div>
                            <p class="text-gray-600 text-sm mb-1">Total Readings</p>
                            <p class="text-3xl font-bold text-gray-800">${state.readings.length}</p>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                            <div class="text-4xl mb-2">📅</div>
                            <p class="text-gray-600 text-sm mb-1">Upcoming Events</p>
                            <p class="text-3xl font-bold text-gray-800">${state.events.length}</p>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                            <div class="text-4xl mb-2">🙏</div>
                            <p class="text-gray-600 text-sm mb-1">Prayer Requests</p>
                            <p class="text-3xl font-bold text-gray-800">${state.prayers.length}</p>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                            <div class="text-4xl mb-2">📢</div>
                            <p class="text-gray-600 text-sm mb-1">Announcements</p>
                            <p class="text-3xl font-bold text-gray-800">${state.announcements.length}</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">📖 Latest Reading</h3>
                            ${state.readings.length > 0 ? `
                                <div class="border-l-4 border-blue-600 pl-4">
                                    <p class="text-sm text-gray-500">${state.readings[0].date}</p>
                                    <p class="font-semibold text-gray-800 mt-1">${state.readings[0].title}</p>
                                    <p class="text-gray-600 mt-2 line-clamp-3">${state.readings[0].content}</p>
                                </div>
                            ` : '<p class="text-gray-500">No readings available yet</p>'}
                        </div>

                        <div class="bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">📅 Upcoming Events</h3>
                            ${state.events.length > 0 ? `
                                <div class="space-y-3">
                                    ${state.events.slice(0, 3).map(event => `
                                        <div class="p-3 bg-purple-50 rounded-lg">
                                            <p class="font-semibold text-gray-800">${event.title}</p>
                                            <p class="text-sm text-gray-600">${event.date} at ${event.time}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : '<p class="text-gray-500">No upcoming events</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderReadingsPage() {
            const filteredReadings = state.readings.filter(r =>
                r.title.toLowerCase().includes(state.searchTerm.toLowerCase()) ||
                r.content.toLowerCase().includes(state.searchTerm.toLowerCase())
            );

            return `
                <div class="max-w-7xl mx-auto px-4 py-8 fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                        <h2 class="text-3xl font-bold text-gray-800">📖 Sunday Readings Archive</h2>
                        ${state.currentUser.role === 'admin' ? `
                            <button onclick="toggleForm('reading')"
                                class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-all">
                                ➕ Add Reading
                            </button>
                        ` : ''}
                    </div>

                    <div class="mb-6">
                        <input type="text" placeholder="Search readings..." 
                            oninput="handleSearch(this.value)" value="${state.searchTerm}"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>

                    ${state.showForms.reading && state.currentUser.role === 'admin' ? `
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Add New Reading</h3>
                            <div class="space-y-4">
                                <input type="text" id="readingTitle" placeholder="Reading Title"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <input type="date" id="readingDate"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <input type="text" id="readingScripture" placeholder="Scripture Reference"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <textarea id="readingContent" placeholder="Reading Content" rows="6"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg"></textarea>
                                <input type="url" id="readingAudio" placeholder="Audio URL (optional)"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <div class="flex gap-4">
                                    <button onclick="addReading()"
                                        class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700">
                                        Save Reading
                                    </button>
                                    <button onclick="toggleForm('reading')"
                                        class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="space-y-6">
                        ${filteredReadings.map(reading => `
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-2xl font-bold text-gray-800">${reading.title}</h3>
                                <p class="text-sm text-gray-500 mt-1">${reading.date}</p>
                                ${reading.scripture ? `<p class="text-sm text-blue-600 font-semibold mt-1">${reading.scripture}</p>` : ''}
                                <p class="text-gray-700 mt-4 whitespace-pre-wrap">${reading.content}</p>
                                ${reading.audioUrl ? `
                                    <audio controls class="w-full mt-4">
                                        <source src="${reading.audioUrl}" type="audio/mpeg">
                                    </audio>
                                ` : ''}
                                <p class="text-xs text-gray-400 mt-4">Added by ${reading.addedBy}</p>
                            </div>
                        `).join('')}
                        ${filteredReadings.length === 0 ? `
                            <div class="text-center py-12">
                                <p class="text-gray-500">No readings found</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderAnnouncementsPage() {
            return `
                <div class="max-w-7xl mx-auto px-4 py-8 fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                        <h2 class="text-3xl font-bold text-gray-800">📢 Church Announcements</h2>
                        ${state.currentUser.role === 'admin' ? `
                            <button onclick="toggleForm('announcement')"
                                class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700">
                                ➕ New Announcement
                            </button>
                        ` : ''}
                    </div>

                    ${state.showForms.announcement && state.currentUser.role === 'admin' ? `
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Create Announcement</h3>
                            <div class="space-y-4">
                                <input type="text" id="announcementTitle" placeholder="Announcement Title"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <select id="announcementPriority"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option value="normal">Normal Priority</option>
                                    <option value="high">High Priority</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                                <textarea id="announcementContent" placeholder="Announcement Details" rows="4"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg"></textarea>
                                <div class="flex gap-4">
                                    <button onclick="addAnnouncement()"
                                        class="flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700">
                                        Post Announcement
                                    </button>
                                    <button onclick="toggleForm('announcement')"
                                        class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="space-y-4">
                        ${state.announcements.map(announcement => `
                            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 ${
                                announcement.priority === 'urgent' ? 'border-red-500' :
                                announcement.priority === 'high' ? 'border-orange-500' : 'border-green-500'
                            }">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <h3 class="text-xl font-bold text-gray-800">${announcement.title}</h3>
                                        <p class="text-gray-700 mt-2">${announcement.content}</p>
                                        <div class="flex items-center gap-4 text-sm text-gray-500 mt-3">
                                            <span>📅 ${announcement.date}</span>
                                            <span>👤 ${announcement.addedBy}</span>
                                        </div>
                                    </div>
                                    ${announcement.priority === 'urgent' ? `
                                        <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-semibold">⚠️ URGENT</span>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                        ${state.announcements.length === 0 ? `
                            <div class="text-center py-12">
                                <p class="text-gray-500">No announcements yet</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderBookingsPage() {
            const myBookings = state.bookings.filter(b => b.memberPhone === state.currentUser.phone);
            const allBookings = state.currentUser.role === 'admin' ? state.bookings : myBookings;
            const timeSlots = ['09:00 AM', '10:00 AM', '11:00 AM', '02:00 PM', '03:00 PM', '04:00 PM'];

            return `
                <div class="max-w-7xl mx-auto px-4 py-8 fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                        <h2 class="text-3xl font-bold text-gray-800">📅 Pastoral Bookings</h2>
                        <button onclick="toggleForm('booking')"
                            class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700">
                            ➕ Book Appointment
                        </button>
                    </div>

                    ${state.showForms.booking ? `
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Book Pastoral Appointment</h3>
                            <div class="space-y-4">
                                <select id="bookingPastor" class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <option>Pastor John</option>
                                    <option>Pastor Mary</option>
                                    <option>Pastor David</option>
                                </select>
                                <input type="date" id="bookingDate" min="${new Date().toISOString().split('T')[0]}"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <input type="hidden" id="bookingTime">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Select Time Slot</label>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        ${timeSlots.map(slot => `
                                            <button type="button" onclick="selectTimeSlot('${slot}')"
                                                class="time-slot px-4 py-3 rounded-lg border-2 border-gray-300 hover:border-purple-400 transition-all">
                                                ${slot}
                                            </button>
                                        `).join('')}
                                    </div>
                                </div>
                                <textarea id="bookingReason" placeholder="Reason for appointment" rows="4"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg"></textarea>
                                <div class="flex gap-4">
                                    <button onclick="addBooking()"
                                        class="flex-1 bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700">
                                        Confirm Booking
                                    </button>
                                    <button onclick="toggleForm('booking')"
                                        class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="space-y-4">
                        ${allBookings.map(booking => `
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <div class="flex justify-between items-start mb-4">
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">${booking.pastor}</h3>
                                        <p class="text-sm text-gray-500 mt-1">with ${booking.memberName}</p>
                                    </div>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                        booking.status === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                                        booking.status === 'confirmed' ? 'bg-green-100 text-green-700' :
                                        'bg-red-100 text-red-700'
                                    }">
                                        ${booking.status.toUpperCase()}
                                    </span>
                                </div>
                                <div class="flex gap-6 text-sm text-gray-600 mb-3">
                                    <span>📅 ${booking.date}</span>
                                    <span>🕐 ${booking.time}</span>
                                </div>
                                <p class="text-gray-700">${booking.reason}</p>
                            </div>
                        `).join('')}
                        ${allBookings.length === 0 ? `
                            <div class="text-center py-12">
                                <p class="text-gray-500">No bookings yet</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderPrayersPage() {
            return `
                <div class="max-w-7xl mx-auto px-4 py-8 fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                        <h2 class="text-3xl font-bold text-gray-800">🙏 Prayer Wall</h2>
                        <button onclick="toggleForm('prayer')"
                            class="bg-pink-600 text-white px-6 py-3 rounded-lg hover:bg-pink-700">
                            ➕ Share Prayer
                        </button>
                    </div>

                    ${state.showForms.prayer ? `
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Share a Prayer Request</h3>
                            <div class="space-y-4">
                                <input type="text" id="prayerTitle" placeholder="Prayer Request Title"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <textarea id="prayerContent" placeholder="Share your prayer request..." rows="4"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg"></textarea>
                                <div class="flex gap-4">
                                    <button onclick="addPrayer()"
                                        class="flex-1 bg-pink-600 text-white py-3 rounded-lg font-semibold hover:bg-pink-700">
                                        Share Prayer
                                    </button>
                                    <button onclick="toggleForm('prayer')"
                                        class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${state.prayers.map(prayer => `
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <h3 class="text-lg font-bold text-gray-800 mb-2">${prayer.title}</h3>
                                <p class="text-gray-700 mb-4">${prayer.content}</p>
                                <div class="flex justify-between items-center">
                                    <div class="text-sm text-gray-500">
                                        <p>👤 ${prayer.author}</p>
                                        <p>📅 ${prayer.date}</p>
                                    </div>
                                    <button onclick="addPrayerSupport(${prayer.id})"
                                        class="flex items-center gap-2 bg-pink-50 text-pink-600 px-4 py-2 rounded-lg hover:bg-pink-100">
                                        ❤️ <span class="font-semibold">${prayer.prayerCount}</span>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                        ${state.prayers.length === 0 ? `
                            <div class="col-span-2 text-center py-12">
                                <p class="text-gray-500">No prayer requests yet</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderEventsPage() {
            return `
                <div class="max-w-7xl mx-auto px-4 py-8 fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                        <h2 class="text-3xl font-bold text-gray-800">📅 Church Events</h2>
                        ${state.currentUser.role === 'admin' ? `
                            <button onclick="toggleForm('event')"
                                class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700">
                                ➕ Create Event
                            </button>
                        ` : ''}
                    </div>

                    ${state.showForms.event && state.currentUser.role === 'admin' ? `
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">Create New Event</h3>
                            <div class="space-y-4">
                                <input type="text" id="eventTitle" placeholder="Event Title"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <input type="date" id="eventDate"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                    <input type="time" id="eventTime"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                </div>
                                <input type="text" id="eventLocation" placeholder="Event Location"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg">
                                <textarea id="eventDescription" placeholder="Event Description" rows="4"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg"></textarea>
                                <div class="flex gap-4">
                                    <button onclick="addEvent()"
                                        class="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700">
                                        Create Event
                                    </button>
                                    <button onclick="toggleForm('event')"
                                        class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${state.events.map(event => {
                            const eventDate = new Date(event.date);
                            return `
                                <div class="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-all">
                                    <div class="bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-lg p-4 mb-4 text-center">
                                        <p class="text-sm opacity-90">${eventDate.toLocaleDateString('en-US', { month: 'short' })}</p>
                                        <p class="text-4xl font-bold">${eventDate.getDate()}</p>
                                    </div>
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">${event.title}</h3>
                                    <div class="space-y-2 text-sm text-gray-600 mb-3">
                                        <div>🕐 ${event.time}</div>
                                        ${event.location ? `<div>📍 ${event.location}</div>` : ''}
                                    </div>
                                    <p class="text-gray-700 text-sm mb-3">${event.description}</p>
                                    <p class="text-xs text-gray-400">👤 ${event.organizer}</p>
                                </div>
                            `;
                        }).join('')}
                        ${state.events.length === 0 ? `
                            <div class="col-span-3 text-center py-12">
                                <p class="text-gray-500">No upcoming events</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            if (!state.currentUser) {
                app.innerHTML = renderLoginPage();
            } else {
                let content = '';
                if (state.currentPage === 'dashboard') content = renderDashboard();
                else if (state.currentPage === 'readings') content = renderReadingsPage();
                else if (state.currentPage === 'announcements') content = renderAnnouncementsPage();
                else if (state.currentPage === 'bookings') content = renderBookingsPage();
                else if (state.currentPage === 'prayers') content = renderPrayersPage();
                else if (state.currentPage === 'events') content = renderEventsPage();
                
                app.innerHTML = renderNavigation() + content;
            }
        }

        // Initialize app
        setTimeout(() => {
            loadData();
            render();
        }, 500);
    </script>
</body>
</html>